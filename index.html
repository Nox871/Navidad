<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Una peque침a carta de Navidad</title>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            font-family: "Courier New", monospace;
            background: url("fondo03.webp") repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .scene {
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16 / 9;
            background:
                linear-gradient(rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.65)),
                url("fondo02.webp") center/cover no-repeat;
            border: 4px solid #b91c1c;
            box-shadow:
                0 0 0 4px #facc15,
                0 0 30px rgba(250, 204, 21, 0.3);
            padding: 16px;
            display: flex;
            gap: 16px;
            border-radius: 8px;
        }

        .character {
            flex: 0 0 220px;
            background: rgba(17, 24, 39, 0.75);
            border: 2px solid #facc15;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .character img {
            max-width: 160px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6));
            /* Flip horizontal para PC */
            transform: scaleX(-1);
        }

        .dialogue-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: relative;
        }

        .dialogue-box {
            background: rgba(2, 6, 23, 0.95);
            border: 2px solid #facc15;
            padding: 18px;
            min-height: 150px;
            color: #f8fafc;
            line-height: 1.7;
            font-size: 18px;
            white-space: pre-line;
            border-radius: 4px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
        }

        .hint {
            position: absolute;
            top: -10px;
            right: 0px;
            font-size: 12px;
            color: #fde68a;
            background: rgba(185, 28, 28, 0.9);
            padding: 4px 12px;
            border: 1px solid #facc15;
            border-radius: 12px;
            animation: blink 1.4s infinite;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .hint:hover {
            transform: scale(1.05);
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .gifts {
            display: none;
            margin-top: 16px;
            gap: 12px;
        }

        .gift {
            flex: 1;
            background: rgba(2, 6, 23, 0.95);
            border: 2px solid #b91c1c;
            box-shadow:
                inset 0 0 0 2px #facc15,
                0 4px 12px rgba(0, 0, 0, 0.4);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .gift:hover {
            transform: translateY(-4px);
            box-shadow:
                inset 0 0 0 2px #facc15,
                0 8px 20px rgba(0, 0, 0, 0.5),
                0 0 15px rgba(250, 204, 21, 0.2);
            animation: shake 0.4s ease-in-out infinite;
        }


        @keyframes shake {

            0%,
            100% {
                transform: translateY(-4px) rotate(0deg);
            }

            25% {
                transform: translateY(-4px) rotate(-1deg);
            }

            75% {
                transform: translateY(-4px) rotate(1deg);
            }
        }

        .gift img {
            max-width: 80px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6));
            transition: transform 0.3s ease;
        }

        .gift:hover img {
            transform: scale(1.1);
        }

        .final-message {
            font-size: 30px;
            text-align: center;
            color: #facc15;
            padding: 40px 20px;
            text-shadow:
                0 0 14px #b91c1c,
                0 0 28px rgba(185, 28, 28, 0.5);
            animation: fadeIn 2s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .scene {
                flex-direction: column;
                aspect-ratio: auto;
            }

            .character {
                height: 180px;
                flex: 0 0 auto;
            }

            .character img {

                transform: scaleX(1);
            }

            .dialogue-box {
                font-size: 16px;
            }

            .gifts {
                flex-direction: column;
            }

            .hint {
                font-size: 11px;
                padding: 3px 10px;
                right: 10px;
            }

            .final-message {
                font-size: 24px;
                padding: 30px 15px;
            }
        }

        .typing-cursor::after {
            content: '|';
            animation: cursorBlink 0.7s infinite;
        }

        @keyframes cursorBlink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        .santa-bounce {
            transform: scaleX(-1) scale(1.05);
        }

        @media (max-width: 768px) {
            .santa-bounce {
                transform: scaleX(1) scale(1.05);
            }
        }

        .dialogue-wrapper {
            position: relative;
        }

        .hint {
            position: absolute;
            top: -10px;
            right: 12px;
        }
    </style>
</head>

<body>

    <div class="scene">
        <div class="character">
            <img id="santaSprite" src="happy-santa-01.webp">
        </div>

        <div class="dialogue-area">
            <div class="dialogue-wrapper">
                <div class="hint" id="hint">toca para continuar</div>
                <div class="dialogue-box" id="dialogue"></div>
            </div>

            <div class="gifts" id="gifts">
                <div class="gift" data-gift="uno"><img src="regalo01.webp"></div>
                <div class="gift" data-gift="dos"><img src="regalo02.webp"></div>
                <div class="gift" data-gift="tres"><img src="regalo03.webp"></div>
            </div>
        </div>
    </div>

    <audio id="bgm" loop src="grandpa_intro.mp3"></audio>
    <audio id="dialogueSound" loop src="dialogo.mp3"></audio>
    <audio id="dialogueEndSound" src="dialogoFin.mp3"></audio>
    <audio id="giftSound" src="gift01.mp3"></audio>

    <script>
        const dialogueBox = document.getElementById("dialogue");
        const bgm = document.getElementById("bgm");
        const santa = document.getElementById("santaSprite");
        const gifts = document.getElementById("gifts");
        const hint = document.getElementById("hint");

        const dialogueSound = document.getElementById("dialogueSound");
        const dialogueEndSound = document.getElementById("dialogueEndSound");
        const giftSound = document.getElementById("giftSound");

        let typing = false;
        let index = 0;
        let musicStarted = false;
        let happy = false;
        let giftTimeout = null;

        const dialogues = [
            "Hola...\n\nGracias por estar aqu칤.",
            "Hoy es Navidad.\nY aunque no todos los d칤as se sienten iguales,\nhoy sigue siendo especial.",
            "Tal vez este a침o fue amable contigo.\nTal vez no tanto.\nO tal vez fue un poco de ambas.",
            "Sea como sea,\nsi est치s leyendo esto,\nhiciste algo bien: llegar hasta aqu칤.",
            "Antes de irte,\ntengo algo peque침o para ti.\nNo hay uno correcto.\nSolo elige uno de estos tres."
        ];

        const giftMessages = {
            uno: `Si est치s leyendo esto,
                entonces hoy alguien pens칩 en ti.

                Tal vez no estemos en la misma mesa,
                ni en la misma casa,
                pero por un momento coincidimos aqu칤.

                Que esta Navidad te regale algo sencillo:
                tranquilidad, calidez
                y al menos una raz칩n para sonre칤r.`,

            dos: `No todas las Navidades son iguales.

                Algunas llegan tranquilas,
                otras un poco ca칩ticas.
                Pero si hoy encuentras algo que te haga sentir bien,
                aunque sea por un rato,
                entonces ya hay algo que celebrar.`,

            tres: `Gracias por seguir aqu칤 este a침o.

                Por todo lo que hiciste,
                por lo que intentaste
                y tambi칠n por lo que no sali칩 aunque
                pusiste el coraz칩n.

                Que esta Navidad te trate con cari침o
                y te recuerde algo importante:
                importas. M치s de lo que imaginas.`
        };

        function toggleSanta() {
            happy = !happy;
            santa.src = happy ? "happy-santa-02.webp" : "happy-santa-01.webp";

            santa.classList.add("santa-bounce");
            setTimeout(() => {
                santa.classList.remove("santa-bounce");
            }, 200);
        }


        function typeText(text, callback) {
            typing = true;
            dialogueBox.textContent = "";
            dialogueBox.classList.add('typing-cursor');

            dialogueSound.currentTime = 0;
            dialogueSound.volume = 0.10;
            dialogueSound.play();

            let i = 0;
            const interval = setInterval(() => {
                dialogueBox.textContent += text[i++];
                if (i >= text.length) {
                    clearInterval(interval);
                    typing = false;
                    dialogueSound.pause();
                    dialogueEndSound.volume = 0.05;
                    dialogueEndSound.play();
                    dialogueBox.classList.remove('typing-cursor');

                    dialogueBox.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        dialogueBox.style.transform = '';
                    }, 100);

                    if (callback) callback();
                }
            }, 40);
        }

        function showFinalMessage() {

            if (giftTimeout) {
                clearTimeout(giftTimeout);
            }

            dialogueBox.className = "dialogue-box final-message";
            dialogueBox.textContent = "Gracias por quedarte un momento aqu칤.\n\n游꾻 춰Feliz Navidad! 游꾻";

            const finalMessage = document.querySelector('.final-message');
            if (finalMessage) {
                finalMessage.style.animation = 'fadeIn 2s ease forwards';
            }
        }

        function nextDialogue() {
            if (typing) return;

            toggleSanta();

            if (!musicStarted) {
                bgm.volume = 0.15;
                bgm.play();
                musicStarted = true;
            }

            if (index < dialogues.length) {
                typeText(dialogues[index++]);
            } else {
                hint.style.display = "none";
                gifts.style.display = "flex";
                document.body.removeEventListener("click", nextDialogue);
            }
        }

        document.body.addEventListener("click", nextDialogue);

        hint.addEventListener("click", function (e) {
            e.stopPropagation();
            nextDialogue();
        });

        document.querySelectorAll(".gift").forEach(g => {
            g.addEventListener("click", function () {

                if (giftTimeout) {
                    clearTimeout(giftTimeout);
                }

                giftSound.volume = 0.15;
                giftSound.play();
                gifts.style.display = "none";

                typeText(giftMessages[this.dataset.gift], () => {

                    giftTimeout = setTimeout(showFinalMessage, 5000);
                });
            });
        });

        typeText(dialogues[index++]);

        function updateSantaOrientation() {
            const isMobile = window.innerWidth <= 768;
            santa.style.transform = isMobile ? 'scaleX(1)' : 'scaleX(-1)';
        }

        window.addEventListener('resize', updateSantaOrientation);

        updateSantaOrientation();
    </script>

</body>

</html>